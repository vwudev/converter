<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video to GIF Converter</title>
  <!-- Load Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Load CSS -->
  <link rel="stylesheet" href="css/styles.css">
  <!-- Thêm COOP/COEP headers để fix SharedArrayBuffer -->
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">
        <i class="fas fa-exchange-alt"></i>
        <span>Video2GIF</span>
      </div>
      <button class="menu-toggle" aria-label="Toggle menu">
        <i class="fas fa-bars"></i>
      </button>
      <ul class="nav-menu">
        <li class="nav-item"><a href="index.html" class="nav-link active">Trang chủ</a></li>
        <li class="nav-item"><a href="video-to-gif.html" class="nav-link">Video to GIF</a></li>
        <li class="nav-item"><a href="image-converter.html" class="nav-link">Chuyển đổi ảnh</a></li>
      </ul>
    </nav>
  </header>

  <main class="container main-content">
    <div id="app">
      <h1 class="text-center"><i class="fas fa-film"></i> Video to GIF Converter</h1>
      
      <div id="loadingStatus" class="status-box">
        <i class="fas fa-spinner fa-spin"></i> Đang tải công cụ chuyển đổi...
      </div>
      
      <div class="converter-box" id="converterUI" style="display:none">
        <!-- Nội dung converter -->
        <div class="form-group">
          <label for="videoInput">Chọn file video:</label>
          <input type="file" id="videoInput" accept="video/*" class="form-control" />
        </div>
        
        <video id="videoPreview" controls class="video-preview"></video>
        
        <div id="videoInfo" class="info-box">
          <p>Thời lượng: <span id="videoDuration">0</span> giây</p>
          <p class="warning"><i class="fas fa-exclamation-triangle"></i> Chỉ 10 giây đầu sẽ được chuyển đổi</p>
        </div>
        
        <button id="convertVideoBtn" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> Chuyển đổi sang GIF
        </button>
        
        <div class="status-box" id="videoStatus">Đã sẵn sàng, chọn video để bắt đầu</div>
        <progress id="progressBar" value="0" max="100" class="progress-bar"></progress>
        
        <a id="gifDownload" class="btn btn-download">
          <i class="fas fa-download"></i> Tải GIF xuống
        </a>
      </div>
    </div>
  </main>
<footer>
  <div class="footer-container">
    <div class="footer-info">
      <h3>ConvertVwu</h3>
      <p><i class="fas fa-map-marker-alt"></i> Xuân Lộc, Đồng Nai, Việt Nam</p>
      <p><i class="fas fa-phone"></i> <a href="tel:0878083973">0878 083 973</a></p>
      <p><i class="fas fa-envelope"></i> <a href="mailto:convert@hub.com">convert@hub.com</a></p>
    </div>


    <div class="footer-socials">
      <a href="#"><i class="fab fa-facebook-f"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-github"></i></a>
      <a href="#"><i class="fab fa-youtube"></i></a>
    </div>
  </div>
  <p class="footer-bottom">© 2023 ConvertVwu. All rights reserved.</p>
</footer>
  <!-- Load FFmpeg từ CDN đáng tin cậy -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
  <script>
    // Khởi tạo FFmpeg với fallback nếu SharedArrayBuffer không khả dụng
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Kiểm tra hỗ trợ SharedArrayBuffer
        if (typeof SharedArrayBuffer === 'undefined') {
          throw new Error('Trình duyệt của bạn không hỗ trợ tính năng này. Vui lòng dùng Chrome/Firefox mới nhất.');
        }

        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ 
          log: true,
          corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js'
        });
        
        window.ffmpeg = ffmpeg;
        window.fetchFile = fetchFile;

        // Hiển thị trạng thái loading
        const loadingStatus = document.getElementById('loadingStatus');
        loadingStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang tải công cụ (lần đầu có thể mất 1-2 phút)...';
        
        await ffmpeg.load();
        
        // Ẩn loading, hiện UI
        loadingStatus.style.display = 'none';
        document.getElementById('converterUI').style.display = 'block';
        
        // Khởi chạy ứng dụng
        initVideoConverter();
      } catch (error) {
        console.error('Lỗi khởi tạo:', error);
        document.getElementById('loadingStatus').innerHTML = `
          <div class="error-box">
            <i class="fas fa-exclamation-circle"></i> ${error.message}
          </div>
        `;
      }
    });
  </script>
  
  <!-- File JavaScript -->
  <script src="js/converter.js"></script>
</body>
</html>
