<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video to GIF Converter | ConvertHub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    #videoPreview {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin: 20px 0;
      display: none;
    }
    
    #videoInfo {
      margin: 10px 0;
      display: none;
    }
    
    .warning {
      color: #e67e22;
      font-weight: bold;
      background-color: #fdf2e9;
      padding: 8px;
      border-radius: 4px;
      margin-top: 5px;
    }
    
    #loadingStatus {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      text-align: center;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">
        <i class="fas fa-exchange-alt"></i>
        <span>Video2GIF</span>
      </div>
    </nav>
  </header>

  <main class="converter-container">
    <h1 class="converter-title"><i class="fas fa-film"></i> Video to GIF Converter</h1>
    
    <div id="loadingStatus">
      <i class="fas fa-spinner fa-spin"></i> Đang tải công cụ chuyển đổi...
    </div>
    
    <div class="tab" id="converterUI" style="display:none">
      <h2>Chuyển Video sang GIF</h2>
      <p>Hỗ trợ: MP4, MOV, AVI (tối đa 10MB)</p>
      
      <label for="videoInput">Chọn file video:</label>
      <input type="file" id="videoInput" accept="video/*" />
      
      <video id="videoPreview" controls></video>
      
      <div id="videoInfo">
        <p>Thời lượng: <span id="videoDuration">0</span> giây</p>
        <p class="warning"><i class="fas fa-exclamation-triangle"></i> Chỉ 10 giây đầu sẽ được chuyển đổi</p>
      </div>
      
      <button id="convertVideoBtn" class="btn">
        <i class="fas fa-sync-alt"></i> Chuyển đổi sang GIF
      </button>
      
      <div class="status" id="videoStatus">Đã sẵn sàng, chọn video để bắt đầu</div>
      <progress id="progressBar" value="0" max="100" style="width:100%;display:none;height:10px;"></progress>
      
      <a id="gifDownload" class="download-btn" style="display:none">
        <i class="fas fa-download"></i> Tải GIF xuống
      </a>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
  <script>
    // Khởi tạo FFmpeg
    document.addEventListener('DOMContentLoaded', async () => {
      const loadingStatus = document.getElementById('loadingStatus');
      const converterUI = document.getElementById('converterUI');
      
      try {
        // Tạo FFmpeg instance
        const { createFFmpeg, fetchFile } = FFmpeg;
        window.ffmpeg = createFFmpeg({ 
          log: true,
          corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js'
        });
        
        // Polyfill fetchFile nếu cần
        window.fetchFile = fetchFile || (async file => {
          return new Uint8Array(await new Response(file).arrayBuffer());
        });

        // Tải FFmpeg
        loadingStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang tải công cụ (lần đầu có thể mất 30s-1 phút)...';
        await window.ffmpeg.load();
        
        // Ẩn loading, hiện UI
        loadingStatus.style.display = 'none';
        converterUI.style.display = 'block';
        
        // Khởi chạy ứng dụng
        initVideoConverter();
      } catch (error) {
        loadingStatus.innerHTML = `
          <div style="color:red">
            <i class="fas fa-exclamation-circle"></i> Lỗi tải công cụ!<br>
            ${error.message}<br>
            Vui lòng tải lại trang hoặc thử trình duyệt khác.
          </div>
        `;
      }
    });
  </script>
  
  <script src="js/converter.js"></script>
</body>
</html>
